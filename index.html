<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
<title>MaidMate | ‡∏´‡∏≤‡πÅ‡∏°‡πà‡∏ö‡πâ‡∏≤‡∏ô ‡∏û‡∏µ‡πà‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á ‡∏°‡∏∑‡∏≠‡∏≠‡∏≤‡∏ä‡∏µ‡∏û</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<style>
    :root {
        /* ‡∏ò‡∏µ‡∏°: Clean & Fresh (Maid Service) */
        --primary: #0d9488;       /* Teal-600 */
        --primary-light: #14b8a6; /* Teal-500 */
        --accent: #ec4899;        /* Pink-500 */
        --bg-body: #f0fdfa;       /* Teal-50 */
        --bg-card: #ffffff;
        --text-main: #134e4a;     /* Teal-900 */
        --text-muted: #64748b;
        --border-color: #ccfbf1;
    }

    body { 
        font-family: 'Prompt', sans-serif; 
        background-color: var(--bg-body); 
        color: var(--text-main); 
        -webkit-tap-highlight-color: transparent; 
        overflow-x: hidden;
        letter-spacing: 0.01em;
        /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏ß‡∏î‡∏•‡∏≤‡∏¢‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏á‡πÜ */
        background-image: radial-gradient(#ccfbf1 1px, transparent 1px);
        background-size: 20px 20px;
    }

    body.no-scroll { overflow: hidden; }
    
    ::-webkit-scrollbar { width: 4px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #99f6e4; border-radius: 4px; }
    
    dialog {
        transition: opacity 0.2s ease, transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
        opacity: 0;
        transform: scale(0.95) translateY(10px);
        border: none;
        outline: none;
        background-color: var(--bg-card);
        color: var(--text-main);
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
        border-radius: 1.5rem; /* ‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡πÇ‡∏Ñ‡πâ‡∏á‡∏°‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏° */
        max-height: 90vh;
        max-width: 95vw;
        overscroll-behavior: contain;
    }
    dialog[open] { opacity: 1; transform: scale(1) translateY(0); }
    dialog::backdrop { background: rgba(19, 78, 74, 0.4); backdrop-filter: blur(2px); }
    
    .nav-solid { 
        background: rgba(255, 255, 255, 0.95); 
        backdrop-filter: blur(10px);
        border-bottom: 1px solid #ccfbf1;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.02);
    }

    input, select, textarea {
        background-color: #ffffff !important;
        color: var(--text-main) !important;
        border: 1px solid #99f6e4 !important;
        border-radius: 1rem !important; /* input ‡∏°‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô */
        box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05) !important; 
        -webkit-appearance: none;
        transition: all 0.2s;
    }
    input:focus, select:focus, textarea:focus {
        border-color: var(--primary) !important;
        outline: none;
        box-shadow: 0 0 0 3px rgba(13, 148, 136, 0.2) !important;
    }

    .field-error { border-color: #f43f5e !important; background-color: #fff1f2 !important; }
    .line-clamp-2 { display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
    
    .job-card {
        background: #ffffff;
        border: 1px solid #f0fdfa;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -2px rgba(0, 0, 0, 0.05); 
        position: relative;
        overflow: hidden;
        border-radius: 1.25rem; /* Card ‡∏°‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô */
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .job-card:active { transform: scale(0.98); }
    
    .btn-primary {
        background: var(--primary);
        color: #fff;
        border: none;
        border-radius: 1rem;
    }
    
    /* Animation ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô */
    .icon-bounce { animation: bounce 2s infinite; }
    @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-3px); } }
    
    .slider-hidden { display: none; }
    .slider-visible { display: flex; animation: fadeIn 0.2s; }
    
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .tag-pill {
        background-color: #f0fdfa;
        color: var(--primary);
        border: 1px solid #ccfbf1;
        border-radius: 9999px;
    }

    .mobile-touch-target { min-height: 44px; min-width: 44px; }
</style>
</head>
<body class="min-h-screen flex flex-col">

<!-- Navigation -->
<nav class="nav-solid sticky top-0 z-50">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex justify-between items-center">
      <!-- Logo Area -->
      <div class="flex items-center gap-3 cursor-pointer select-none" onclick="refreshApp()">
        <div class="bg-gradient-to-br from-teal-400 to-teal-600 text-white w-10 h-10 rounded-full flex items-center justify-center shadow-md border-2 border-white">
            <i class="fa-solid fa-broom text-lg icon-bounce"></i>
        </div>
        <div>
            <span class="font-bold text-lg text-teal-800 tracking-tight block leading-none">Maid<span class="text-teal-500">Mate</span></span>
            <span class="text-[9px] text-gray-400 font-bold uppercase tracking-widest">Home Service</span>
        </div>
      </div>
      
      <!-- Right Side Actions -->
      <div class="flex items-center gap-3">
         <!-- Desktop Filter -->
         <div class="hidden lg:flex bg-white p-1 rounded-full border border-teal-100 shadow-sm">
             <select id="filter_province_desktop" class="bg-transparent px-3 py-1.5 text-sm outline-none cursor-pointer border-r border-teal-50 text-gray-600 font-medium hover:text-teal-700 transition-colors mr-2">
                <option value="all">üìç ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ (‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)</option>
             </select>
             <div class="relative">
                 <input id="q_desktop" type="text" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏°‡πà‡∏ö‡πâ‡∏≤‡∏ô, ‡∏ã‡∏±‡∏Å‡∏£‡∏µ‡∏î..." class="bg-transparent pl-8 pr-4 py-1.5 text-sm w-56 outline-none text-gray-700 border-none focus:ring-0 placeholder-gray-400 font-medium">
                 <i class="fa-solid fa-search absolute left-3 top-2 text-teal-300 text-xs"></i>
             </div>
         </div>

         <!-- Register Button -->
         <button onclick="openNewPostModal()" class="bg-gradient-to-r from-pink-500 to-rose-500 text-white px-5 py-2 rounded-full font-bold text-sm shadow-md hover:shadow-lg active:scale-95 transition-all flex items-center gap-2 border border-white/20">
            <i class="fa-solid fa-plus-circle text-xs"></i> 
            <span>‡∏•‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</span>
         </button>
      </div>
  </div>
</nav>

<!-- Mobile Filter Bar -->
<div class="lg:hidden bg-white/80 backdrop-blur-md border-b border-teal-50 px-4 py-3 sticky top-16 z-40 shadow-sm">
    <div class="flex gap-2 w-full">
        <select id="filter_province_mobile" class="border border-teal-100 rounded-2xl px-3 py-0 text-xs bg-white outline-none w-[35%] font-medium text-gray-600 h-11 shadow-sm">
            <option value="all">üìç ‡∏ó‡∏∏‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà</option>
        </select>
        <div class="relative w-[65%]">
            <input id="q_mobile" type="text" placeholder="‡∏´‡∏≤‡πÅ‡∏°‡πà‡∏ö‡πâ‡∏≤‡∏ô, ‡∏û‡∏µ‡πà‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á..." class="w-full pl-9 pr-3 py-0 bg-white border border-teal-100 rounded-2xl text-xs outline-none text-gray-700 placeholder-gray-400 h-11 font-medium appearance-none shadow-sm focus:border-teal-400">
            <i class="fa-solid fa-sparkles absolute left-3.5 top-3.5 text-teal-400 text-xs animate-pulse"></i>
        </div>
    </div>
</div>

<header class="bg-white relative overflow-hidden rounded-b-[2rem] shadow-sm border-b border-teal-50">
    <!-- Decorate Background -->
    <div class="absolute top-0 right-0 -mr-20 -mt-20 w-64 h-64 bg-teal-50 rounded-full blur-3xl opacity-60"></div>
    <div class="absolute bottom-0 left-0 -ml-20 -mb-10 w-40 h-40 bg-pink-50 rounded-full blur-2xl opacity-60"></div>

    <div class="max-w-7xl mx-auto px-4 py-8 relative z-10">
        <div class="flex flex-col items-center text-center sm:items-start sm:text-left">
            <div class="inline-flex items-center gap-2 px-3 py-1 bg-teal-50 rounded-full mb-3 border border-teal-100">
                <div id="statusDot" class="w-2 h-2 bg-gray-300 rounded-full"></div>
                <span class="text-[10px] font-bold text-teal-700 uppercase tracking-widest"><span id="countTutors" class="text-teal-900 text-xs mr-1 font-extrabold">0</span> Verified Helpers</span>
            </div>
            <h1 class="text-3xl font-bold text-gray-800 tracking-tight leading-tight mb-2">
                ‡∏á‡∏≤‡∏ô‡∏ö‡πâ‡∏≤‡∏ô <span class="text-transparent bg-clip-text bg-gradient-to-r from-teal-500 to-teal-700">‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏á‡πà‡∏≤‡∏¢</span><br>
                <span class="text-lg font-medium text-gray-500">‡∏´‡∏≤‡πÅ‡∏°‡πà‡∏ö‡πâ‡∏≤‡∏ô‡∏°‡∏∑‡∏≠‡∏≠‡∏≤‡∏ä‡∏µ‡∏û ‡πÉ‡∏Å‡∏•‡πâ‡∏ö‡πâ‡∏≤‡∏ô‡∏Ñ‡∏∏‡∏ì</span>
            </h1>
        </div>
    </div>
</header>

<main class="flex-grow max-w-7xl mx-auto px-4 py-6 w-full relative z-20">
    <!-- Loader (Shows only if no cache) -->
    <div id="loading" class="flex flex-col items-center justify-center py-16 bg-white/50 backdrop-blur rounded-3xl border border-white shadow-sm hidden">
        <div class="w-12 h-12 border-4 border-teal-100 border-t-teal-500 rounded-full animate-spin mb-4"></div>
        <p class="text-teal-400 text-[10px] font-bold tracking-widest uppercase">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
    </div>
    
    <!-- Grid -->
    <section id="board" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4 pb-8"></section>

    <!-- Pagination -->
    <div id="pagination" class="flex justify-center items-center gap-4 pb-12">
        <button onclick="changePage(-1)" id="btnPrev" class="w-11 h-11 flex items-center justify-center rounded-full bg-white border border-teal-100 text-teal-600 hover:bg-teal-50 disabled:opacity-30 shadow-sm transition-colors"><i class="fa-solid fa-arrow-left"></i></button>
        <span id="pageIndicator" class="text-sm font-bold text-teal-800 font-mono bg-white px-4 py-1 rounded-full border border-teal-50 shadow-sm">1 / 1</span>
        <button onclick="changePage(1)" id="btnNext" class="w-11 h-11 flex items-center justify-center rounded-full bg-white border border-teal-100 text-teal-600 hover:bg-teal-50 disabled:opacity-30 shadow-sm transition-colors"><i class="fa-solid fa-arrow-right"></i></button>
    </div>
</main>

<footer class="bg-white text-gray-500 py-8 px-4 border-t border-teal-50 text-center mt-auto">
    <div class="inline-block p-3 bg-teal-50 rounded-full mb-3">
        <i class="fa-solid fa-shield-heart text-teal-500 text-2xl"></i>
    </div>
    <p class="text-[10px] uppercase tracking-widest text-gray-400 mb-4 font-bold">Verified & Secure</p>
    <p class="text-[10px]">¬© 2024 MaidMate Service.</p>
</footer>

<!-- View Detail Dialog -->
<dialog id="viewDlg" class="w-full max-w-4xl p-0 rounded-3xl overflow-hidden bg-white shadow-2xl">
    <div class="flex flex-col md:grid md:grid-cols-12 h-[85vh] md:h-[600px]">
        <!-- Image Section -->
        <div class="flex-none h-64 md:h-full md:col-span-7 bg-gray-100 relative group">
            <div id="detailImageHero" class="w-full h-full relative">
                <img id="viewHeroImg" src="" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105" loading="lazy" onerror="handleImgError(this)">
                <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent opacity-60"></div>
            </div>
            <div class="absolute bottom-4 left-4 right-4">
                <div class="flex gap-2 overflow-x-auto pb-2 no-scrollbar" id="viewImages"></div>
            </div>
            <!-- Mobile Controls -->
            <div class="absolute top-4 right-4 flex gap-3 md:hidden z-20">
                <button id="btnDeletePostMobile" class="bg-white/80 text-red-500 w-9 h-9 rounded-full flex items-center justify-center backdrop-blur shadow-lg hover:bg-white transition-all"><i class="fa-solid fa-trash-can"></i></button>
                <button onclick="closeViewModal()" class="bg-white/80 text-gray-800 w-9 h-9 rounded-full flex items-center justify-center backdrop-blur shadow-lg hover:bg-white transition-all"><i class="fa-solid fa-times"></i></button>
            </div>
        </div>
        
        <!-- Info Section -->
        <div class="flex-grow md:col-span-5 flex flex-col bg-white overflow-hidden relative">
            <!-- Pattern -->
            <div class="absolute top-0 right-0 w-32 h-32 bg-teal-50 rounded-bl-full opacity-50 pointer-events-none"></div>

            <div class="p-6 overflow-y-auto flex-grow relative z-10">
                <div class="flex justify-between items-start mb-5">
                    <div class="px-3 py-1 bg-green-100 text-green-700 text-[10px] font-bold rounded-full border border-green-200 uppercase tracking-wide flex items-center gap-1">
                        <i class="fa-solid fa-check-circle"></i> ‡∏ß‡πà‡∏≤‡∏á‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô
                    </div>
                    <!-- Desktop Controls -->
                    <div class="flex gap-3 hidden md:flex">
                        <button id="btnDeletePostDesktop" class="text-gray-400 hover:text-red-500 transition-colors" title="‡∏•‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®"><i class="fa-solid fa-trash-can text-lg"></i></button>
                        <button onclick="closeViewModal()" class="text-gray-400 hover:text-gray-800 transition-colors"><i class="fa-solid fa-times text-xl"></i></button>
                    </div>
                </div>

                <h2 id="viewTitle" class="text-xl font-bold text-teal-900 mb-3 leading-tight"></h2>
                
                <div class="flex flex-wrap items-center gap-2 mb-6 text-xs text-gray-500">
                    <span id="viewProvince" class="tag-pill px-2 py-1 flex items-center gap-1"><i class="fa-solid fa-map-marker-alt"></i> <span class="truncate"></span></span>
                    <span id="viewAddress" class="tag-pill px-2 py-1 flex items-center gap-1 truncate max-w-[150px]"><i class="fa-solid fa-home"></i> <span></span></span>
                </div>

                <div class="bg-gradient-to-r from-teal-50 to-white rounded-2xl p-4 border border-teal-100 mb-6 relative overflow-hidden">
                    <div class="absolute -right-4 -top-4 text-teal-100/50 text-6xl"><i class="fa-solid fa-coins"></i></div>
                    <p class="text-[9px] text-teal-500 uppercase font-bold tracking-wider mb-1">‡∏Ñ‡πà‡∏≤‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</p>
                    <div class="flex items-baseline gap-1">
                        <span id="viewPrice" class="text-3xl font-extrabold text-teal-700 font-mono"></span>
                        <span class="text-xs text-gray-500 font-medium">‡∏ö‡∏≤‡∏ó</span>
                    </div>
                </div>

                <div class="mb-4">
                    <h4 class="text-[11px] font-bold text-gray-400 uppercase mb-3 flex items-center gap-2">
                        <i class="fa-solid fa-align-left"></i> ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô
                    </h4>
                    <div id="viewBody" class="text-sm text-gray-600 leading-relaxed whitespace-pre-line bg-gray-50 p-4 rounded-xl border border-gray-100"></div>
                </div>
            </div>

            <!-- Footer Action -->
            <div class="p-5 border-t border-gray-100 bg-white flex-none sticky bottom-0 z-20 shadow-[0_-5px_15px_rgba(0,0,0,0.02)]">
                <div class="flex justify-between items-center text-xs mb-3">
                    <div class="flex items-center gap-2">
                         <div class="w-8 h-8 rounded-full bg-teal-100 flex items-center justify-center text-teal-600"><i class="fa-solid fa-user"></i></div>
                         <div>
                             <span class="block text-[9px] text-gray-400 uppercase">‡∏ú‡∏π‡πâ‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</span>
                             <span id="viewContact" class="font-bold text-gray-800"></span>
                         </div>
                    </div>
                </div>
                <a id="btnCall" href="#" class="w-full bg-gradient-to-r from-teal-600 to-teal-500 text-white py-3.5 rounded-xl font-bold text-sm shadow-lg shadow-teal-200 active:scale-98 transition-all flex items-center justify-center gap-2 hover:brightness-105">
                    <i class="fa-solid fa-phone-volume animate-pulse"></i> ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏à‡πâ‡∏≤‡∏á‡∏á‡∏≤‡∏ô / ‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°
                </a>
            </div>
        </div>
    </div>
</dialog>

<!-- Registration Dialog -->
<dialog id="dlg" class="w-full max-w-lg p-0 rounded-3xl overflow-hidden bg-white shadow-2xl h-[95vh] sm:h-auto">
    <div class="flex flex-col h-full bg-gray-50">
        <!-- Header -->
        <div class="px-6 py-5 border-b border-gray-100 flex justify-between items-center bg-white flex-none sticky top-0 z-10">
            <h3 id="dlgTitle" class="text-lg font-bold text-gray-800 flex items-center gap-2">
                <span class="w-8 h-8 rounded-full bg-pink-100 text-pink-500 flex items-center justify-center text-xs"><i class="fa-solid fa-edit"></i></span> 
                ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà
            </h3>
            <button onclick="closeModal()" class="text-gray-400 hover:text-gray-800 w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center"><i class="fa-solid fa-times"></i></button>
        </div>
        
        <!-- Scrollable Form -->
        <div class="p-6 overflow-y-auto flex-grow space-y-5">
            <div class="bg-white p-5 rounded-2xl border border-gray-100 shadow-sm space-y-4">
                <h4 class="text-[10px] font-bold text-teal-500 uppercase tracking-wider flex items-center gap-2">
                    <i class="fa-solid fa-info-circle"></i> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£
                </h4>
                <div>
                    <label class="text-xs text-gray-500 mb-1 block pl-1">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏® *</label>
                    <input id="title" type="text" class="w-full px-4 py-2.5 text-sm" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏£‡∏±‡∏ö‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡∏Ñ‡∏≠‡∏ô‡πÇ‡∏î, ‡∏û‡∏µ‡πà‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡πÄ‡∏î‡πá‡∏Å...">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div class="relative">
                        <label class="text-xs text-gray-500 mb-1 block pl-1">‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà *</label>
                        <select id="input_province" class="w-full px-4 py-2.5 text-sm appearance-none"><option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</option></select>
                        <i class="fa-solid fa-chevron-down absolute right-4 top-9 text-xs text-gray-400 pointer-events-none"></i>
                    </div>
                    <div class="relative">
                        <label class="text-xs text-gray-500 mb-1 block pl-1">‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô *</label>
                        <input id="price" type="number" class="w-full pl-4 pr-8 py-2.5 text-sm" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏Ñ‡∏≤">
                        <span class="absolute right-4 top-9 text-xs text-gray-400">‡∏ø</span>
                    </div>
                </div>
            </div>

            <div class="bg-white p-5 rounded-2xl border border-gray-100 shadow-sm space-y-4">
                <h4 class="text-[10px] font-bold text-teal-500 uppercase tracking-wider flex items-center gap-2">
                    <i class="fa-solid fa-address-card"></i> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠
                </h4>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <input id="contact_name" type="text" class="w-full px-4 py-2.5 text-sm" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô / ‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó">
                    </div>
                    <div>
                        <input id="phone" type="tel" class="w-full px-4 py-2.5 text-sm" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå *">
                    </div>
                </div>
                <input id="address" type="text" class="w-full px-4 py-2.5 text-sm" placeholder="‡πÄ‡∏Ç‡∏ï / ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠ / ‡∏à‡∏∏‡∏î‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï">
                <textarea id="body" rows="4" class="w-full px-4 py-3 text-sm resize-none" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° ‡πÄ‡∏ä‡πà‡∏ô:
- ‡∏£‡∏±‡∏ö‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ
- ‡∏ã‡∏±‡∏Å‡∏£‡∏µ‡∏î (‡∏Ñ‡∏¥‡∏î‡πÅ‡∏¢‡∏Å)
- ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÑ‡∏õ‡πÄ‡∏≠‡∏á ‡∏´‡∏£‡∏∑‡∏≠ ‡πÉ‡∏´‡πâ‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°
- ‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå 3 ‡∏õ‡∏µ..."></textarea>
            </div>
        
            <div class="bg-white p-5 rounded-2xl border border-gray-100 shadow-sm">
                <div class="flex justify-between items-center mb-3">
                    <h4 class="text-[10px] font-bold text-teal-500 uppercase tracking-wider flex items-center gap-2"><i class="fa-solid fa-images"></i> ‡∏£‡∏π‡∏õ‡∏ú‡∏•‡∏á‡∏≤‡∏ô (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 3)</h4>
                    <span id="imgCount" class="text-[9px] text-white bg-gray-300 px-2 py-0.5 rounded-full">0/3</span>
                </div>
                <div class="grid grid-cols-4 gap-3">
                    <div id="previewList" class="contents"></div>
                    <label id="uploadBtn" class="aspect-square border-2 border-dashed border-teal-200 rounded-xl bg-teal-50/50 flex flex-col items-center justify-center text-teal-400 cursor-pointer hover:bg-teal-50 hover:border-teal-300 transition-colors">
                        <i class="fa-solid fa-camera text-lg mb-1"></i>
                        <span class="text-[8px] font-bold">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏π‡∏õ</span>
                        <input id="img" type="file" class="hidden" accept="image/*" multiple onchange="appendImages(this)">
                    </label>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <div class="p-5 border-t border-gray-200 bg-white flex-none flex gap-3 shadow-[0_-5px_15px_rgba(0,0,0,0.02)]">
            <button onclick="closeModal()" class="px-6 py-3 text-gray-500 font-bold text-sm rounded-xl border border-gray-200 hover:bg-gray-50 transition-colors">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            <button onclick="savePost()" id="btnSave" class="flex-1 bg-gradient-to-r from-teal-500 to-teal-700 text-white py-3 rounded-xl font-bold text-sm shadow-lg shadow-teal-100 active:scale-95 transition-all">
                <span id="btnSaveText">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</span> 
            </button>
        </div>
    </div>
</dialog>

<!-- Image Slider -->
<div id="imageSlider" class="fixed inset-0 z-[100] bg-black/95 backdrop-blur-sm hidden flex-col items-center justify-center">
    <button onclick="closeImageSlider()" class="absolute top-6 right-6 text-white/70 hover:text-white w-12 h-12 bg-white/10 rounded-full transition-colors"><i class="fa-solid fa-times text-xl"></i></button>
    <div class="w-full h-full flex items-center justify-center p-4">
        <button onclick="changeSlide(-1)" class="absolute left-4 text-white/70 hover:text-white w-12 h-12 bg-black/30 rounded-full flex items-center justify-center backdrop-blur-sm"><i class="fa-solid fa-chevron-left"></i></button>
        <img id="sliderMainImage" src="" class="max-w-full max-h-[85vh] object-contain rounded-lg shadow-2xl">
        <button onclick="changeSlide(1)" class="absolute right-4 text-white/70 hover:text-white w-12 h-12 bg-black/30 rounded-full flex items-center justify-center backdrop-blur-sm"><i class="fa-solid fa-chevron-right"></i></button>
    </div>
    <div class="absolute bottom-8 text-white text-xs bg-white/10 px-4 py-2 rounded-full font-mono tracking-widest border border-white/10"><span id="sliderCounter"></span></div>
</div>

<script>
// ==========================================
// CONFIG & SYSTEM (Logic Remains unchanged)
// ==========================================
const API_URL = "https://script.google.com/macros/s/AKfycbx7dacXQW2TsUcvDxeubbXujX-WCyFfFECpxTPyGoUZMRKRyWR9z1BeXR31JI0Rtmhf/exec"; 
const PROVINCES = ["‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏°‡∏´‡∏≤‡∏ô‡∏Ñ‡∏£", "‡∏Å‡∏£‡∏∞‡∏ö‡∏µ‡πà", "‡∏Å‡∏≤‡∏ç‡∏à‡∏ô‡∏ö‡∏∏‡∏£‡∏µ", "‡∏Å‡∏≤‡∏¨‡∏™‡∏¥‡∏ô‡∏ò‡∏∏‡πå", "‡∏Å‡∏≥‡πÅ‡∏û‡∏á‡πÄ‡∏û‡∏ä‡∏£", "‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô", "‡∏à‡∏±‡∏ô‡∏ó‡∏ö‡∏∏‡∏£‡∏µ", "‡∏â‡∏∞‡πÄ‡∏ä‡∏¥‡∏á‡πÄ‡∏ó‡∏£‡∏≤", "‡∏ä‡∏•‡∏ö‡∏∏‡∏£‡∏µ", "‡∏ä‡∏±‡∏¢‡∏ô‡∏≤‡∏ó", "‡∏ä‡∏±‡∏¢‡∏†‡∏π‡∏°‡∏¥", "‡∏ä‡∏∏‡∏°‡∏û‡∏£", "‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡∏£‡∏≤‡∏¢", "‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà", "‡∏ï‡∏£‡∏±‡∏á", "‡∏ï‡∏£‡∏≤‡∏î", "‡∏ï‡∏≤‡∏Å", "‡∏ô‡∏Ñ‡∏£‡∏ô‡∏≤‡∏¢‡∏Å", "‡∏ô‡∏Ñ‡∏£‡∏õ‡∏ê‡∏°", "‡∏ô‡∏Ñ‡∏£‡∏û‡∏ô‡∏°", "‡∏ô‡∏Ñ‡∏£‡∏£‡∏≤‡∏ä‡∏™‡∏µ‡∏°‡∏≤", "‡∏ô‡∏Ñ‡∏£‡∏®‡∏£‡∏µ‡∏ò‡∏£‡∏£‡∏°‡∏£‡∏≤‡∏ä", "‡∏ô‡∏Ñ‡∏£‡∏™‡∏ß‡∏£‡∏£‡∏Ñ‡πå", "‡∏ô‡∏ô‡∏ó‡∏ö‡∏∏‡∏£‡∏µ", "‡∏ô‡∏£‡∏≤‡∏ò‡∏¥‡∏ß‡∏≤‡∏™", "‡∏ô‡πà‡∏≤‡∏ô", "‡∏ö‡∏∂‡∏á‡∏Å‡∏≤‡∏¨", "‡∏ö‡∏∏‡∏£‡∏µ‡∏£‡∏±‡∏°‡∏¢‡πå", "‡∏õ‡∏ó‡∏∏‡∏°‡∏ò‡∏≤‡∏ô‡∏µ", "‡∏õ‡∏£‡∏∞‡∏à‡∏ß‡∏ö‡∏Ñ‡∏µ‡∏£‡∏µ‡∏Ç‡∏±‡∏ô‡∏ò‡πå", "‡∏õ‡∏£‡∏≤‡∏à‡∏µ‡∏ô‡∏ö‡∏∏‡∏£‡∏µ", "‡∏õ‡∏±‡∏ï‡∏ï‡∏≤‡∏ô‡∏µ", "‡∏û‡∏£‡∏∞‡∏ô‡∏Ñ‡∏£‡∏®‡∏£‡∏µ‡∏≠‡∏¢‡∏∏‡∏ò‡∏¢‡∏≤", "‡∏û‡∏∞‡πÄ‡∏¢‡∏≤", "‡∏û‡∏±‡∏á‡∏á‡∏≤", "‡∏û‡∏±‡∏ó‡∏•‡∏∏‡∏á", "‡∏û‡∏¥‡∏à‡∏¥‡∏ï‡∏£", "‡∏û‡∏¥‡∏©‡∏ì‡∏∏‡πÇ‡∏•‡∏Å", "‡πÄ‡∏û‡∏ä‡∏£‡∏ö‡∏∏‡∏£‡∏µ", "‡πÄ‡∏û‡∏ä‡∏£‡∏ö‡∏π‡∏£‡∏ì‡πå", "‡πÅ‡∏û‡∏£‡πà", "‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï", "‡∏°‡∏´‡∏≤‡∏™‡∏≤‡∏£‡∏Ñ‡∏≤‡∏°", "‡∏°‡∏∏‡∏Å‡∏î‡∏≤‡∏´‡∏≤‡∏£", "‡πÅ‡∏°‡πà‡∏Æ‡πà‡∏≠‡∏á‡∏™‡∏≠‡∏ô", "‡∏¢‡πÇ‡∏™‡∏ò‡∏£", "‡∏¢‡∏∞‡∏•‡∏≤", "‡∏£‡πâ‡∏≠‡∏¢‡πÄ‡∏≠‡πá‡∏î", "‡∏£‡∏∞‡∏ô‡∏≠‡∏á", "‡∏£‡∏∞‡∏¢‡∏≠‡∏á", "‡∏£‡∏≤‡∏ä‡∏ö‡∏∏‡∏£‡∏µ", "‡∏•‡∏û‡∏ö‡∏∏‡∏£‡∏µ", "‡∏•‡∏≥‡∏õ‡∏≤‡∏á", "‡∏•‡∏≥‡∏û‡∏π‡∏ô", "‡πÄ‡∏•‡∏¢", "‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏©", "‡∏™‡∏Å‡∏•‡∏ô‡∏Ñ‡∏£", "‡∏™‡∏á‡∏Ç‡∏•‡∏≤", "‡∏™‡∏ï‡∏π‡∏•", "‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏õ‡∏£‡∏≤‡∏Å‡∏≤‡∏£", "‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏™‡∏á‡∏Ñ‡∏£‡∏≤‡∏°", "‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏™‡∏≤‡∏Ñ‡∏£", "‡∏™‡∏£‡∏∞‡πÅ‡∏Å‡πâ‡∏ß", "‡∏™‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏µ", "‡∏™‡∏¥‡∏á‡∏´‡πå‡∏ö‡∏∏‡∏£‡∏µ", "‡∏™‡∏∏‡πÇ‡∏Ç‡∏ó‡∏±‡∏¢", "‡∏™‡∏∏‡∏û‡∏£‡∏£‡∏ì‡∏ö‡∏∏‡∏£‡∏µ", "‡∏™‡∏∏‡∏£‡∏≤‡∏©‡∏é‡∏£‡πå‡∏ò‡∏≤‡∏ô‡∏µ", "‡∏™‡∏∏‡∏£‡∏¥‡∏ô‡∏ó‡∏£‡πå", "‡∏´‡∏ô‡∏≠‡∏á‡∏Ñ‡∏≤‡∏¢", "‡∏´‡∏ô‡∏≠‡∏á‡∏ö‡∏±‡∏ß‡∏•‡∏≥‡∏†‡∏π", "‡∏≠‡πà‡∏≤‡∏á‡∏ó‡∏≠‡∏á", "‡∏≠‡∏≥‡∏ô‡∏≤‡∏à‡πÄ‡∏à‡∏£‡∏¥‡∏ç", "‡∏≠‡∏∏‡∏î‡∏£‡∏ò‡∏≤‡∏ô‡∏µ", "‡∏≠‡∏∏‡∏ï‡∏£‡∏î‡∏¥‡∏ï‡∏ñ‡πå", "‡∏≠‡∏∏‡∏ó‡∏±‡∏¢‡∏ò‡∏≤‡∏ô‡∏µ", "‡∏≠‡∏∏‡∏ö‡∏•‡∏£‡∏≤‡∏ä‡∏ò‡∏≤‡∏ô‡∏µ"].sort();

let posts = [], filteredPosts = [], currentPage = 1, formImages = [], sliderImages = [], sliderIndex = 0;
const ITEMS_PER_PAGE = 15; 
const CACHE_KEY = 'maidmate_posts_cache'; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Key ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏î‡∏¥‡∏°‡∏°‡∏≤‡∏õ‡∏ô

// Mock Data (‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏ö‡πâ‡∏≤‡∏ô)
function getMockData() {
    return [
        { id: 1, title: "‡∏£‡∏±‡∏ö‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡∏Ñ‡∏≠‡∏ô‡πÇ‡∏î ‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô/‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå", price: 500, province: "‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏°‡∏´‡∏≤‡∏ô‡∏Ñ‡∏£", contact_name: "‡∏õ‡πâ‡∏≤‡πÅ‡∏à‡πã‡∏ß ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£", phone: "089-123-4567", address: "‡πÄ‡∏Ç‡∏ï‡∏à‡∏ï‡∏∏‡∏à‡∏±‡∏Å‡∏£", body: "‡πÅ‡∏°‡πà‡∏ö‡πâ‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå 10 ‡∏õ‡∏µ ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏Ñ‡∏£‡∏ö ‡πÄ‡∏ä‡πá‡∏î‡∏Å‡∏£‡∏∞‡∏à‡∏Å ‡∏ñ‡∏π‡∏û‡∏∑‡πâ‡∏ô ‡∏•‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥" },
        { id: 2, title: "‡∏ã‡∏±‡∏Å‡∏≠‡∏ö‡∏£‡∏µ‡∏î ‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡∏ñ‡∏∂‡∏á‡∏ó‡∏µ‡πà ‡∏á‡∏≤‡∏ô‡πÄ‡∏ô‡∏µ‡πä‡∏¢‡∏ö", price: 40, province: "‡∏ô‡∏ô‡∏ó‡∏ö‡∏∏‡∏£‡∏µ", contact_name: "‡∏£‡πâ‡∏≤‡∏ô‡∏´‡∏≠‡∏°‡∏ü‡∏∏‡πâ‡∏á", phone: "081-987-6543", address: "‡∏õ‡∏≤‡∏Å‡πÄ‡∏Å‡∏£‡πá‡∏î", body: "‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ï‡∏±‡∏ß‡∏•‡∏∞ 40 ‡∏ö‡∏≤‡∏ó ‡∏ã‡∏±‡∏Å‡πÅ‡∏´‡πâ‡∏á ‡∏ã‡∏±‡∏Å‡∏°‡∏∑‡∏≠ ‡∏ñ‡∏ô‡∏≠‡∏°‡∏ú‡πâ‡∏≤" },
        { id: 3, title: "‡∏û‡∏µ‡πà‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡πÄ‡∏î‡πá‡∏Å ‡πÑ‡∏õ-‡∏Å‡∏•‡∏±‡∏ö ‡πÉ‡∏à‡πÄ‡∏¢‡πá‡∏ô ‡∏£‡∏±‡∏Å‡πÄ‡∏î‡πá‡∏Å", price: 15000, province: "‡∏õ‡∏ó‡∏∏‡∏°‡∏ò‡∏≤‡∏ô‡∏µ", contact_name: "‡∏û‡∏µ‡πà‡πÅ‡∏ô‡∏ô", phone: "090-555-4444", address: "‡∏Ñ‡∏•‡∏≠‡∏á‡∏´‡∏•‡∏ß‡∏á", body: "‡∏£‡∏±‡∏ö‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡πÄ‡∏î‡πá‡∏Å 6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ ‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå-‡∏®‡∏∏‡∏Å‡∏£‡πå ‡∏°‡∏µ‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏ö‡∏£‡∏°" },
        { id: 4, title: "‡∏î‡∏π‡πÅ‡∏•‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏ ‡πÄ‡∏ù‡πâ‡∏≤‡πÑ‡∏Ç‡πâ ‡∏ï‡∏≤‡∏°‡∏ö‡πâ‡∏≤‡∏ô/‡∏£‡∏û.", price: 800, province: "‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏õ‡∏£‡∏≤‡∏Å‡∏≤‡∏£", contact_name: "‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏±‡∏Å", phone: "086-111-2222", address: "‡∏ö‡∏≤‡∏á‡∏û‡∏•‡∏µ", body: "‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏ö‡∏£‡∏°‡∏î‡∏π‡πÅ‡∏•‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏ ‡∏õ‡πâ‡∏≠‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£ ‡∏û‡∏•‡∏¥‡∏Å‡∏ï‡∏±‡∏ß ‡∏ó‡∏≥‡∏Å‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô" },
        { id: 5, title: "Big Cleaning ‡∏¢‡πâ‡∏≤‡∏¢‡πÄ‡∏Ç‡πâ‡∏≤-‡∏¢‡πâ‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å", price: 2500, province: "‡∏ä‡∏•‡∏ö‡∏∏‡∏£‡∏µ", contact_name: "Clean Express", phone: "082-333-7777", address: "‡∏®‡∏£‡∏µ‡∏£‡∏≤‡∏ä‡∏≤", body: "‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏•‡∏±‡∏á ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡∏¢‡∏∞ ‡∏Ç‡∏±‡∏î‡∏û‡∏∑‡πâ‡∏ô ‡∏•‡∏≠‡∏Å‡∏Ñ‡∏£‡∏≤‡∏ö‡∏Å‡∏≤‡∏ß" },
        { id: 6, title: "‡πÅ‡∏°‡πà‡∏ö‡πâ‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏≠‡∏≠‡∏ü‡∏ü‡∏¥‡∏® ‡πÅ‡∏°‡πà‡∏ö‡πâ‡∏≤‡∏ô‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô", price: 12000, province: "‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà", contact_name: "‡∏ö.‡∏Ñ‡∏•‡∏µ‡∏ô‡∏ô‡∏¥‡πà‡∏á ‡∏à‡∏≥‡∏Å‡∏±‡∏î", phone: "053-222-333", address: "‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà", body: "‡πÅ‡∏°‡πà‡∏ö‡πâ‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏™‡∏±‡∏á‡∏Ñ‡∏° ‡∏ï‡∏£‡∏ß‡∏à‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏≠‡∏≤‡∏ä‡∏ç‡∏≤‡∏Å‡∏£‡∏£‡∏°‡πÅ‡∏•‡πâ‡∏ß" }
    ];
}

const dom = {
    loading: document.getElementById('loading'),
    board: document.getElementById('board'),
    pageIndicator: document.getElementById('pageIndicator'),
    btnPrev: document.getElementById('btnPrev'),
    btnNext: document.getElementById('btnNext'),
    dlg: document.getElementById('dlg'),
    viewDlg: document.getElementById('viewDlg'),
    btnSaveText: document.getElementById('btnSaveText'),
    title: document.getElementById('title'),
    price: document.getElementById('price'),
    province: document.getElementById('input_province'),
    contactName: document.getElementById('contact_name'),
    phone: document.getElementById('phone'),
    address: document.getElementById('address'),
    body: document.getElementById('body'),
    imgPreview: document.getElementById('previewList'),
    imgCount: document.getElementById('imgCount'),
    uploadBtn: document.getElementById('uploadBtn'),
    filterDesktop: document.getElementById('filter_province_desktop'),
    filterMobile: document.getElementById('filter_province_mobile'),
    qDesktop: document.getElementById('q_desktop'),
    qMobile: document.getElementById('q_mobile'),
    slider: document.getElementById('imageSlider'),
    sliderImg: document.getElementById('sliderMainImage'),
    sliderCount: document.getElementById('sliderCounter'),
    viewHero: document.getElementById('viewHeroImg'),
    countTutors: document.getElementById('countTutors'),
    statusDot: document.getElementById('statusDot')
};

function handleImgError(img) { img.src = 'https://placehold.co/600x400/f0fdfa/0d9488?text=MaidMate+No+Image'; }
function setScrollLock(lock) { document.body.classList.toggle('no-scroll', lock); }

function init() {
    populateProvinces();
    loadPosts();
    [dom.qDesktop, dom.qMobile].forEach(el => el.addEventListener('input', debounce(applyFilters, 400)));
    if(dom.filterDesktop) dom.filterDesktop.addEventListener('change', (e) => {
        dom.filterDesktop.value = dom.filterMobile.value = e.target.value;
        applyFilters();
    });
    dom.filterMobile.addEventListener('change', (e) => {
        if(dom.filterDesktop) dom.filterDesktop.value = dom.filterMobile.value = e.target.value;
        else dom.filterMobile.value = e.target.value;
        applyFilters();
    });
}

function populateProvinces() {
    const html = PROVINCES.map(p => `<option value="${p}">${p}</option>`).join('');
    if(dom.province) dom.province.innerHTML = `<option value="">üìç ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î (‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)</option>${html}`;
    if(dom.filterDesktop) dom.filterDesktop.innerHTML = `<option value="all">üìç ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ (‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)</option>${html}`;
    if(dom.filterMobile) dom.filterMobile.innerHTML = `<option value="all">üìç ‡∏ó‡∏∏‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà</option>${html}`;
}

async function loadPosts() {
    // 1. Load Cache Immediately
    const cachedData = localStorage.getItem(CACHE_KEY);
    if (cachedData) {
        try {
            posts = JSON.parse(cachedData);
            if(dom.countTutors) dom.countTutors.textContent = posts.length;
            if(dom.statusDot) dom.statusDot.classList.replace('bg-gray-300', 'bg-teal-500'); // Cached
            applyFilters();
        } catch(e) { console.error("Cache Error", e); }
    } else {
        if(dom.loading) dom.loading.classList.remove('hidden');
    }

    // 2. Fetch Fresh Data
    try {
        const res = await fetch(`${API_URL}?t=${Date.now()}`);
        if (!res.ok) throw new Error('API Error');
        const data = await res.json();
        const rawPosts = (Array.isArray(data) ? data : data.data || []);
        
        // Process
        const freshPosts = rawPosts.map(p => {
            let imgs = [];
            try {
                const imgData = p.images;
                if (typeof imgData === 'string' && imgData.trim().startsWith('[')) imgs = JSON.parse(imgData);
                else if (imgData && imgData !== "null") imgs = [imgData];
            } catch(e) { imgs = p.images ? [p.images] : []; }
            return { ...p, images: imgs.map(url => url.includes('id=') ? `https://lh3.googleusercontent.com/d/${url.split('id=')[1].split('&')[0]}` : url) };
        }).reverse();

        // Update State & Cache
        posts = freshPosts;
        localStorage.setItem(CACHE_KEY, JSON.stringify(posts));
        
        // Update UI
        if(dom.countTutors) dom.countTutors.textContent = posts.length;
        if(dom.statusDot) {
            dom.statusDot.classList.replace('bg-teal-500', 'bg-green-400'); // Live
            dom.statusDot.classList.add('animate-pulse');
        }
        applyFilters();
        if(dom.loading) dom.loading.classList.add('hidden');

    } catch (e) {
        console.warn('Fetch Failed, using fallback:', e);
        if(dom.loading) dom.loading.classList.add('hidden');
        if(dom.statusDot) dom.statusDot.classList.replace('bg-gray-300', 'bg-red-400'); // Error
        
        if (posts.length === 0) {
            posts = getMockData().map(p => ({...p, images: []}));
            applyFilters();
            Swal.fire({ toast: true, position: 'top', icon: 'info', title: '‡πÇ‡∏´‡∏°‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á (Offline)', timer: 3000, showConfirmButton: false });
        }
    }
}

function applyFilters() {
    const q = (dom.qDesktop.value || dom.qMobile.value).toLowerCase();
    const prov = dom.filterDesktop ? dom.filterDesktop.value : (dom.filterMobile ? dom.filterMobile.value : 'all');
    
    filteredPosts = posts.filter(p => {
        const matchText = (String(p.title)+String(p.body)+String(p.province)).toLowerCase().includes(q);
        const matchProv = prov === 'all' || p.province === prov;
        return matchText && matchProv;
    });
    currentPage = 1;
    renderBoard();
}

function renderBoard() {
    dom.board.innerHTML = '';
    const start = (currentPage - 1) * ITEMS_PER_PAGE;
    const items = filteredPosts.slice(start, start + ITEMS_PER_PAGE);
    
    if (items.length === 0) {
        dom.board.innerHTML = `<div class="col-span-full py-16 text-center text-gray-300 text-sm italic tracking-wide flex flex-col items-center"><i class="fa-solid fa-wind text-4xl mb-2 text-gray-200"></i> ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>`;
    } else {
        items.forEach(p => {
            const thumb = (p.images && p.images.length > 0) ? p.images[0] : 'https://placehold.co/400x300/f0fdfa/0d9488?text=MaidMate';
            const card = document.createElement('div');
            card.className = "job-card group cursor-pointer flex flex-col h-full hover:-translate-y-1";
            card.onclick = () => viewDetail(p.id);
            card.innerHTML = `
                <div class="aspect-[4/3] bg-teal-50 relative overflow-hidden">
                    <img src="${thumb}" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110" loading="lazy" decoding="async" onerror="this.src='https://placehold.co/400x300/f0fdfa/0d9488?text=MaidMate'">
                    <div class="absolute top-2 left-2 bg-white/95 backdrop-blur px-2 py-1 rounded-md text-[9px] font-bold text-teal-700 shadow-sm border border-white">
                       <i class="fa-solid fa-map-marker-alt text-pink-500"></i> ${p.province}
                    </div>
                </div>
                <div class="p-3 flex flex-col flex-grow">
                    <h3 class="font-bold text-teal-900 text-sm leading-snug line-clamp-2 h-10 mb-2 group-hover:text-teal-600 transition-colors">${p.title}</h3>
                    <div class="mt-auto pt-2 border-t border-teal-50 flex justify-between items-end">
                        <div class="text-[9px] text-gray-400 font-medium">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</div>
                        <div class="text-teal-700 font-bold text-sm bg-teal-50 px-2 py-0.5 rounded-lg">‡∏ø${Number(p.price).toLocaleString()}</div>
                    </div>
                </div>
            `;
            dom.board.appendChild(card);
        });
    }
    updatePagination();
}

function updatePagination() {
    const total = Math.ceil(filteredPosts.length / ITEMS_PER_PAGE) || 1;
    dom.pageIndicator.textContent = `${currentPage} / ${total}`;
    dom.btnPrev.disabled = currentPage === 1;
    dom.btnNext.disabled = currentPage === total;
}

function changePage(delta) { currentPage += delta; renderBoard(); window.scrollTo({ top: 0, behavior: 'smooth' }); }
function openNewPostModal() { resetForm(); dom.dlg.showModal(); setScrollLock(true); }
function closeModal() { dom.dlg.close(); setScrollLock(false); }

function viewDetail(id) {
    const p = posts.find(x => x.id === id);
    if (!p) return;
    dom.viewHero.src = (p.images && p.images.length > 0) ? p.images[0] : 'https://placehold.co/600x400/f0fdfa/0d9488?text=MaidMate';
    document.getElementById('viewTitle').textContent = p.title;
    document.getElementById('viewPrice').textContent = `${Number(p.price).toLocaleString()}`;
    document.getElementById('viewContact').textContent = p.contact_name || '‡∏ú‡∏π‡πâ‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£';
    document.getElementById('viewProvince').querySelector('span').textContent = p.province;
    document.getElementById('viewAddress').querySelector('span').textContent = p.address || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
    document.getElementById('viewBody').textContent = p.body || '-';
    document.getElementById('btnCall').href = p.phone ? `tel:${p.phone}` : "#";
    
    const imgBox = document.getElementById('viewImages');
    imgBox.innerHTML = '';
    sliderImages = p.images || [];
    if (sliderImages.length === 0) sliderImages = ['https://placehold.co/600x400/f0fdfa/0d9488?text=MaidMate'];

    sliderImages.forEach((url, i) => {
        const img = document.createElement('img');
        img.src = url;
        img.className = `h-14 w-14 rounded-lg object-cover border-2 cursor-pointer transition-all hover:scale-105 ${i===0?'border-teal-400 ring-2 ring-teal-100':'border-white opacity-70 hover:opacity-100'}`;
        img.onclick = (e) => { e.stopPropagation(); openSlider(i); };
        imgBox.appendChild(img);
    });

    // Desktop delete button
    document.getElementById('btnDeletePostDesktop').onclick = (e) => { e.stopPropagation(); confirmDelete(p.id); };
    
    // Mobile delete button (safe check)
    const btnMobile = document.getElementById('btnDeletePostMobile');
    if(btnMobile) btnMobile.onclick = (e) => { e.stopPropagation(); confirmDelete(p.id); };

    dom.viewDlg.showModal();
    setScrollLock(true);
}

function closeViewModal() { dom.viewDlg.close(); setScrollLock(false); }

async function confirmDelete(id) {
    closeViewModal(); 
    const res = await Swal.fire({ 
        title: '‡∏•‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®?', 
        text: "‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°",
        icon: 'warning', 
        showCancelButton: true, 
        confirmButtonColor: '#0d9488', 
        cancelButtonColor: '#94a3b8', 
        confirmButtonText: '‡∏•‡∏ö‡πÄ‡∏•‡∏¢',
        cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
        background: '#fff',
        customClass: { popup: 'rounded-2xl' }
    });
    if (res.isConfirmed) {
        Swal.fire({ title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏ö...', allowOutsideClick: false, didOpen: () => Swal.showLoading(), background: 'transparent', color: '#fff' });
        try {
            await fetch(API_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify({ action: 'delete', id: id }) });
            // Optimistic update
            posts = posts.filter(p => p.id !== id);
            localStorage.setItem(CACHE_KEY, JSON.stringify(posts));
            applyFilters();
            
            Swal.fire({ icon: 'success', title: '‡∏•‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', timer: 1000, showConfirmButton: false });
        } catch (e) { Swal.fire('Error', '‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', 'error'); }
    }
}

function appendImages(input) {
    const files = Array.from(input.files);
    files.slice(0, 3 - formImages.length).forEach(file => {
        const reader = new FileReader();
        reader.onload = (e) => { formImages.push(e.target.result); renderPreview(); };
        reader.readAsDataURL(file);
    });
}

function renderPreview() {
    dom.imgPreview.innerHTML = '';
    formImages.forEach((src, i) => {
        const div = document.createElement('div');
        div.className = "relative aspect-square rounded-xl overflow-hidden border border-teal-100 shadow-sm";
        div.innerHTML = `<img src="${src}" class="w-full h-full object-cover"><button onclick="removeImg(${i})" class="absolute top-1 right-1 bg-red-500 text-white w-5 h-5 rounded-full flex items-center justify-center text-[10px] shadow-sm hover:bg-red-600 transition-colors"><i class="fa-solid fa-times"></i></button>`;
        dom.imgPreview.appendChild(div);
    });
    dom.imgCount.textContent = `${formImages.length}/3`;
    dom.uploadBtn.parentElement.classList.toggle('hidden', formImages.length >= 3);
}

function removeImg(i) { formImages.splice(i, 1); renderPreview(); }

async function savePost() {
    const validations = [dom.title, dom.price, dom.province, dom.phone];
    let ok = true;
    validations.forEach(el => {
        if (!el.value.trim()) { el.classList.add('field-error'); ok = false; }
        else el.classList.remove('field-error');
    });
    if (!ok) return Swal.fire({ icon: 'error', title: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö', text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô *', timer: 1500, showConfirmButton: false, customClass: { popup: 'rounded-2xl' } });

    const btn = document.getElementById('btnSave');
    btn.disabled = true; dom.btnSaveText.textContent = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...";
    
    try {
        await fetch(API_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify({
            action: 'add', id: Date.now(), title: dom.title.value, price: Number(dom.price.value),
            province: dom.province.value, address: dom.address.value, contact_name: dom.contactName.value,
            phone: dom.phone.value, body: dom.body.value, images: formImages
        })});
        
        closeModal();
        Swal.fire({ title: '‡∏•‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', icon: 'success', timer: 1500, showConfirmButton: false, customClass: { popup: 'rounded-2xl' } });
        setTimeout(() => loadPosts(), 1000);
    } catch (e) { Swal.fire('Error', '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', 'error'); } 
    finally { btn.disabled = false; dom.btnSaveText.textContent = "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®"; }
}

function openSlider(i) {
    sliderIndex = i;
    dom.sliderImg.src = sliderImages[i];
    dom.sliderCount.textContent = `${i + 1}/${sliderImages.length}`;
    dom.slider.classList.remove('hidden'); dom.slider.classList.add('flex');
    setScrollLock(true);
}

function closeImageSlider() { dom.slider.classList.add('hidden'); dom.slider.classList.remove('flex'); setScrollLock(false); }

function changeSlide(n) {
    sliderIndex = (sliderIndex + n + sliderImages.length) % sliderImages.length;
    dom.sliderImg.src = sliderImages[sliderIndex];
    dom.sliderCount.textContent = `${sliderIndex + 1}/${sliderImages.length}`;
}

function debounce(fn, t) { let timer; return (...args) => { clearTimeout(timer); timer = setTimeout(() => fn(...args), t); }; }

function resetForm() {
    dom.title.value = dom.price.value = dom.province.value = dom.contactName.value = dom.phone.value = dom.address.value = dom.body.value = '';
    formImages = []; renderPreview();
    [dom.title, dom.price, dom.province, dom.phone].forEach(el => el.classList.remove('field-error'));
}

function refreshApp() {
    dom.qDesktop.value = dom.qMobile.value = '';
    if(dom.filterDesktop) dom.filterDesktop.value = 'all';
    if(dom.filterMobile) dom.filterMobile.value = 'all';
    loadPosts();
}

init();
</script>
</body>
</html>